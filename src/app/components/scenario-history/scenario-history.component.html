<div>
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-2xl font-bold text-[var(--c-text-headings)]">History</h2>
  </div>

  @if (selectedHistoryId()) {
    <div class="text-center py-10">
      <svg class="animate-spin mx-auto h-8 w-8 text-[var(--color-primary)]" xmlns="http://www.w3.org/2000/svg"
        fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
        </path>
      </svg>
      <p class="mt-4 font-semibold text-[var(--c-text-body)]">{{ loadingMessage() }}</p>
    </div>
  } @else if (organizedHistory().length === 0) {
    <div class="text-center py-10 text-[var(--c-text-muted)]">
      <i class="fa-solid fa-clock-rotate-left text-4xl mb-4 opacity-50"></i>
      <p>No history found. Start practicing to build your history!</p>
    </div>
  } @else {
    <div class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
      @for (group of organizedHistory(); track group.topic) {
        <div class="border border-[var(--c-border-subtle)] rounded-lg overflow-hidden">
          <div class="bg-[var(--c-bg-muted)] px-3 py-2 border-b border-[var(--c-border-subtle)]">
            <h3 class="text-sm font-semibold text-[var(--c-text-headings)]">{{ group.topic }}</h3>
          </div>
          <div class="p-2">
            @for (diffGroup of group.difficulties; track diffGroup.difficulty) {
              <div class="mb-2 last:mb-0">
                <div class="flex items-center gap-2 mb-1.5">
                  <span
                    class="font-mono text-xs bg-[var(--c-bg-surface)] text-[var(--c-text-muted)] px-2 py-0.5 rounded">{{
                    diffGroup.difficulty }}</span>
                  <span class="text-xs text-[var(--c-text-muted)]">{{ diffGroup.scenarios.length }}</span>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-1.5 ml-3">
                  @for (item of diffGroup.scenarios; track item.id) {
                    <button (click)="loadFromHistory(item)"
                      class="text-left p-2 bg-[var(--c-bg-muted)] rounded hover:bg-[var(--c-border-subtle)] transition-colors group">
                      <p
                        class="font-medium text-xs text-[var(--c-text-headings)] group-hover:text-[var(--color-primary)] truncate">
                        {{ item.name }}</p>
                      <p class="text-xs text-[var(--c-text-muted)] mt-0.5 line-clamp-1">{{ item.description }}
                      </p>
                      <p class="text-xs text-[var(--c-text-muted)] mt-1 opacity-75">
                        {{ formatDate(item.createdAt) }}
                      </p>
                    </button>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  @if (error()) {
    <div class="mt-6 bg-red-100 dark:bg-red-900/20 border-l-4 border-red-500 text-red-700 dark:text-red-400 p-4 rounded-r-lg"
      role="alert">
      <p class="font-bold">An Error Occurred</p>
      <p>{{ error() }}</p>
    </div>
  }
</div>

