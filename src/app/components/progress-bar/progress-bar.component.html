<div class="w-full py-3 sm:py-6 md:py-8 overflow-x-auto" role="navigation" aria-label="Conversation Steps">
  <div class="relative w-full max-w-6xl mx-auto px-2 sm:px-6 md:px-8">
    <!-- Base line with subtle gradient -->
    <div
      class="absolute inset-x-0 top-5 sm:top-7 md:top-8 h-0.5 sm:h-1 bg-gradient-to-r from-slate-100 via-slate-200 to-slate-100 dark:from-slate-800 dark:via-slate-700 dark:to-slate-800 rounded-full -z-10 shadow-inner">
    </div>

    <!-- Progress fill with glow effect -->
    <div
      class="absolute left-0 top-5 sm:top-7 md:top-8 h-0.5 sm:h-1 bg-gradient-to-r from-primary-500 via-lilac-500 to-primary-600 rounded-full transition-all duration-700 ease-out shadow-lg"
      [style.width]="progressPercent() + '%'"
      [style.filter]="'drop-shadow(0 0 ' + (viewportService.isMobile() ? '3px' : '8px') + ' rgba(168, 85, 247, 0.4))'">
    </div>

    <!-- Steps -->
    <div class="flex justify-between items-start relative gap-1 sm:gap-2">
      @for (step of steps; track step; let i = $index) {
      <div class="flex flex-col items-center text-center group cursor-pointer touch-manipulation flex-shrink-0 min-w-0"
        [attr.aria-current]="isActive(i) ? 'step' : null" (click)="onStepClick(step)"
        (keydown.enter)="onStepClick(step)" (keydown.space)="onStepClick(step)" role="button"
        [attr.aria-label]="'Navigate to ' + step + ' step'">

        <!-- Active Step -->
        @if (isActive(i)) {
        <div
          class="relative flex items-center justify-center rounded-full w-9 h-9 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-primary-600 via-lilac-600 to-primary-700 ring-2 sm:ring-4 ring-primary-300 dark:ring-primary-400 scale-105 sm:scale-110 shadow-lg sm:shadow-2xl transition-all duration-500 ease-out will-change-transform"
          tabindex="0">
          <div
            class="absolute inset-0 rounded-full bg-gradient-to-br from-primary-400 to-lilac-400 opacity-30 blur-md sm:blur-xl hidden sm:block">
          </div>
          <i class="relative text-sm sm:text-lg md:text-xl text-white drop-shadow-md" [ngClass]="getIcon(step)"></i>
        </div>
        <p
          class="mt-1.5 sm:mt-3 text-[9px] leading-[10px] sm:text-xs md:text-sm font-bold tracking-tight sm:tracking-wide text-lilac-600 dark:text-lilac-400 transition-all duration-300 max-w-[48px] sm:max-w-[80px] md:max-w-none break-words hyphens-auto">
          {{ getStepLabelKey(step) | transloco }}
        </p>
        }

        <!-- Completed Step -->
        @if (isCompleted(i)) {
        <div
          class="relative flex items-center justify-center rounded-full w-9 h-9 sm:w-12 sm:h-12 md:w-14 md:h-14 bg-gradient-to-br from-emerald-500 to-emerald-600 ring-2 sm:ring-4 ring-emerald-300 dark:ring-emerald-400 shadow-md sm:shadow-lg transition-all duration-500 ease-out group-hover:scale-110 will-change-transform"
          tabindex="0">
          <i class="relative text-sm sm:text-lg md:text-xl text-white" [ngClass]="getIcon(step)"></i>
        </div>
        <p
          class="mt-1.5 sm:mt-3 text-[9px] leading-[10px] sm:text-xs md:text-sm font-semibold tracking-tight sm:tracking-normal text-emerald-700 dark:text-emerald-300 transition-all duration-300 max-w-[48px] sm:max-w-[80px] md:max-w-none break-words hyphens-auto">
          {{ getStepLabelKey(step) | transloco }}
        </p>
        }

        <!-- Upcoming Step -->
        @if (isUpcoming(i)) {
        <div
          class="relative flex items-center justify-center rounded-full w-9 h-9 sm:w-12 sm:h-12 md:w-14 md:h-14 ring-2 sm:ring-4 shadow-sm transition-all duration-500 ease-out group-hover:scale-110 will-change-transform"
          [ngClass]="{
            'bg-white ring-slate-200': themeService.theme() === 'light',
            'bg-slate-700 ring-slate-500': themeService.theme() === 'dark'
          }" tabindex="0">
          <i class="relative text-sm sm:text-lg md:text-xl" [ngClass]="[getIcon(step), getColor(step)]"></i>
        </div>
        <p class="mt-1.5 sm:mt-3 text-[9px] leading-[10px] sm:text-xs md:text-sm font-medium tracking-tight sm:tracking-normal transition-all duration-300 max-w-[48px] sm:max-w-[80px] md:max-w-none break-words hyphens-auto"
          [ngClass]="{
            'text-slate-500': themeService.theme() === 'light',
            'text-slate-300': themeService.theme() === 'dark'
          }">
          {{ getStepLabelKey(step) | transloco }}
        </p>
        }

      </div>
      }
    </div>
  </div>
</div>